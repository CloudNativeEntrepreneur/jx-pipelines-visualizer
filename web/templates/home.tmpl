{{ $root := . }}
<html>
<head>
    <link href="/static/app.css" type="text/css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css" type="text/css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready( function () {
            $.fn.dataTable.ext.order['dom-order'] = function  ( settings, col ) {
                return this.api().column( col, {order:'index'} ).nodes().map( function ( td, i ) {
                    return $(td).data('order');
                } );
            };
            $('#pipelines').DataTable({
                lengthMenu: [ [10, 25, 50, 100, -1], [10, 25, 50, 100, "All"] ],
                pageLength: 25,
                order: [[5, 'desc']],
                columnDefs: [
                    { targets: 'branch', orderDataType: 'dom-order' },
                    { targets: 'start', orderDataType: 'dom-order' },
                    { targets: 'end', orderDataType: 'dom-order' },
                    { targets: 'duration', orderDataType: 'dom-order', type: 'numeric' },
                    { targets: 'author', visible: false }
                ]
            });
        });
    </script>
</head>
<body>
    <h1>Jenkins X Pipelines</h1>
    <table id="pipelines" class="display cell-border">
        <thead>
            <tr>
                <th class="repository">Repository</th>
                <th class="branch">Branch</th>
                <th class="build">Build</th>
                <th class="context">Context</th>
                <th class="status">Status</th>
                <th class="start">Start</th>
                <th class="end">End</th>
                <th class="duration">Duration</th>
                <th class="author"></th>
            </tr>
        </thead>
        <tbody>
            {{ range .Pipelines.Pipelines }}
            <tr>
                <td><a href="/{{ .Owner }}/{{ .Repository }}">{{ .Owner }}/{{ .Repository }}</a></td>
                <td data-order="{{ .Branch }}"><img src="{{ .AuthorAvatarURL }}" title="{{ .Author }}" width="20px"> <a href="/{{ .Owner }}/{{ .Repository }}/{{ .Branch }}">{{ .Branch }}</a></td>
                <td><a href="/{{ .Owner }}/{{ .Repository }}/{{ .Branch }}/{{ .Build }}">{{ .Build }}</a></td>
                <td>{{ .Context }}</td>
                <td class="status-{{ lower .Status }}">{{ .Status }}</td>
                <td data-order='{{ .Start.Format "2006-01-02 15:04:05" }}'>
                    {{- if (vdate .Start).IsToday -}}
                        {{ .Start.Format "15:04:05" }}
                    {{- else -}}
                        {{ .Start.Format "2006-01-02 15:04:05" }}
                    {{- end -}}
                </td>
                <td data-order='{{ if not .End.IsZero }}{{ .End.Format "2006-01-02 15:04:05" }}{{ end }}'>
                    {{- if not .End.IsZero }}
                        {{- if (vdate .End).IsToday -}}
                            {{ .End.Format "15:04:05" }}
                        {{- else -}}
                            {{ .End.Format "2006-01-02 15:04:05" }}
                        {{- end -}}
                    {{- end -}}
                </td>
                <td data-order="{{ .Duration.Seconds }}">{{ with .Duration }}{{ . }}{{ end }}</td>
                <td>{{ .Author }}</td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</body>
</html>